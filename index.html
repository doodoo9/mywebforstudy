<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Study Flight</title>
    <link rel="stylesheet" href="style.css">
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8405706440402113"
        crossorigin="anonymous"></script>

    <style>
        /* ... existing styles ... */

        #static-plane-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100px;
            height: 100px;
            transform: translate(-50%, -50%);
            z-index: 10;
            pointer-events: none;
            /* Let clicks pass to map */
            display: none;
            /* Use a CSS plane or image here. Using FontAwesome for simplicity matches the theme */
            font-size: 60px;
            color: #00d4ff;
            text-align: center;
            line-height: 100px;
            filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.3));
        }

        /* ... existing styles ... */
        .bottom-controls {
            position: absolute;
            bottom: 2rem;
            right: 2rem;
            display: flex;
            gap: 1rem;
            z-index: 100;
            pointer-events: auto;
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        .control-btn.active {
            background: #00d4ff;
            /* Active color */
            color: #000;
            box-shadow: 0 0 15px #00d4ff;
        }
    </style>
</head>

<body>
    <div id="map-view"
        style="position: absolute; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 0; display: none;"></div>
    <div id="cesiumContainer" style="width: 100vw; height: 100vh;"></div>
    <!-- <div id="static-plane-overlay"> Removed for 3D Overlay </div> -->

    <!-- UI Overlay -->
    <div class="ui-overlay">
        <div id="top-bar">
            <div class="logo">
                <i class="fa-solid fa-paper-plane"></i>
                <span>Study Flight</span>
            </div>

            <div id="lang-toggle" class="status-badge" style="cursor: pointer;">
                <span class="active-lang">KR</span> / <span class="inactive-lang">EN</span>
            </div>
        </div>



        <div class="flight-controls" id="flight-controls">
            <!-- Step 1: Destination Selection Info -->
            <div class="control-panel" id="panel-setup">
                <h2 data-i18n="setup_title">나만의 비행 계획</h2>
                <p data-i18n="setup_desc">지구본에서 <strong>출발지</strong>와 <strong>도착지</strong>를 선택하세요.</p>

                <!-- Voice Selection -->
                <div class="voice-selection"
                    style="margin-bottom: 1rem; display: flex; gap: 0.5rem; justify-content: center;">
                    <select id="voice-kr" class="voice-select">
                        <option value="ko-KR-SunHiNeural">SunHi (여성)</option>
                        <option value="ko-KR-InJoonNeural">InJoon (남성)</option>
                    </select>
                    <select id="voice-en" class="voice-select">
                        <option value="en-US-AriaNeural">Aria (Female)</option>
                        <option value="en-US-GuyNeural">Guy (Male)</option>
                        <option value="en-US-JennyNeural">Jenny (Female)</option>
                        <option value="en-US-ChristopherNeural">Christopher (Male)</option>
                    </select>
                </div>

                <div class="route-info">
                    <div class="airport-box">
                        <span class="label" data-i18n="label_from">출발</span>
                        <span id="origin-code" class="value">--</span>
                    </div>
                    <div class="line"></div>
                    <div class="airport-box">
                        <span class="label" data-i18n="label_to">도착</span>
                        <span id="dest-code" class="value">--</span>
                    </div>
                </div>
                <!-- Real flight info display -->
                <div id="real-flight-info" class="real-flight-info">
                    <h3 data-i18n="label_est_time">예상 비행 시간</h3>
                    <div class="time-big">
                        <i class="fa-regular fa-clock"></i> <span id="real-time-display">--:--:--</span>
                    </div>
                </div>

                <!-- Integrated Flight Controls (Mini Bar) -->
                <div id="integrated-controls" class="integrated-controls hidden">
                    <button id="view-toggle" class="mini-btn" title="지도/지구본 전환">
                        <i class="fa-solid fa-map"></i>
                    </button>
                    <button id="theme-toggle" class="mini-btn" title="지도 테마 변경" style="display: none;">
                        <i class="fa-solid fa-layer-group"></i>
                    </button>
                    <button id="btn-focus" class="mini-btn" title="비행기 위치로 이동">
                        <i class="fa-solid fa-crosshairs"></i>
                    </button>
                </div>

                <!-- AdSense Ad Unit -->
                <div class="ad-container">
                    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-8405706440402113"
                        data-ad-slot="1234567890" data-ad-format="auto" data-full-width-responsive="true"></ins>
                    <script>
                        (adsbygoogle = window.adsbygoogle || []).push({});
                    </script>
                </div>

                <button id="btn-takeoff" class="action-btn" disabled data-i18n="btn_takeoff">
                    비행 시작
                </button>
            </div>

            <!-- Step 2: In Flight Info -->
            <div class="control-panel hidden" id="panel-flight">
                <div class="timer-display" id="flight-timer">00:00:00</div>
                <p class="flight-message" id="flight-message" data-i18n="msg_cruising">순항 고도 진입 중</p>
                <button id="btn-abort" class="text-btn" data-i18n="btn_abort">비행 중단</button>
            </div>
        </div>
    </div>

    <!-- Audio Permission & Language Modal -->
    <div id="start-modal" class="modal-overlay">
        <div class="modal-content">
            <i class="fa-solid fa-earth-asia"></i>
            <h2 id="modal-title">Select Language</h2>

            <div id="lang-selection">
                <button class="lang-select-btn" data-lang="kr">한국어</button>
                <button class="lang-select-btn" data-lang="en">English</button>
            </div>

            <div id="enter-app-area" class="hidden">
                <p id="modal-desc">Please enable audio for the best experience.</p>
                <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 1.5rem;">
                    <button id="btn-init-app" class="primary-btn">Enter Cockpit</button>
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="/app.js"></script>
</body>

</html>