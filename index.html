<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>studyfocus</title>
    <link rel="stylesheet" href="style.css">
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8405706440402113"
        crossorigin="anonymous"></script>

    <style>
        /* ... existing styles ... */

        #static-plane-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100px;
            height: 100px;
            transform: translate(-50%, -50%);
            z-index: 10;
            pointer-events: none;
            /* Let clicks pass to map */
            display: none;
            /* Use a CSS plane or image here. Using FontAwesome for simplicity matches the theme */
            font-size: 60px;
            color: #00d4ff;
            text-align: center;
            line-height: 100px;
            filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.3));
        }

        /* ... existing styles ... */
        .bottom-controls {
            position: absolute;
            bottom: 2rem;
            right: 2rem;
            display: flex;
            gap: 1rem;
            z-index: 100;
            pointer-events: auto;
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        .control-btn.active {
            background: #00d4ff;
            /* Active color */
            color: #000;
            box-shadow: 0 0 15px #00d4ff;
        }
    </style>
</head>

<body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-content">
            <h1>SKYFOCUS</h1>
            <div class="loading-bar-container">
                <div class="loading-bar" id="loading-bar"></div>
            </div>
            <div class="loading-text" id="loading-text">initializing...</div>
        </div>
    </div>

    <div id="map-view"
        style="position: absolute; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 0; opacity: 0; pointer-events: none; transition: opacity 0.5s ease;">
    </div>
    <div id="cesiumContainer" style="width: 100vw; height: 100vh; transition: opacity 0.5s ease;"></div>
    <!-- <div id="static-plane-overlay"> Removed for 3D Overlay </div> -->

    <!-- UI Overlay -->
    <div class="ui-overlay">
        <div id="top-bar">
            <div id="menu-btn" class="menu-btn">
                <i class="fa-solid fa-bars"></i>
            </div>
        </div>

        <!-- Menu Drawer -->
        <div id="menu-overlay" class="hidden"></div>
        <div id="menu-drawer" class="menu-drawer hidden">
            <div class="menu-header">
                <div class="logo">
                    <i class="fa-solid fa-paper-plane"></i>
                    <span>skyfocus.cloud</span>
                </div>
                <div id="menu-close-btn" class="menu-close-btn">
                    <i class="fa-solid fa-xmark"></i>
                </div>
            </div>
            <div class="menu-items">
                <div class="menu-item" id="menu-about">
                    <i class="fa-solid fa-circle-info"></i>
                    <span data-i18n="menu_about">About</span>
                </div>
                <div class="menu-item" id="menu-changes">
                    <i class="fa-solid fa-list-ul"></i>
                    <span data-i18n="menu_changes">Changes</span>
                </div>
                <!-- Notices Menu Item -->
                <div class="menu-item" id="menu-notices">
                    <i class="fa-solid fa-bullhorn"></i>
                    <span data-i18n="menu_notices">Notices</span>
                </div>
                <!-- Login Menu Item -->
                <div class="menu-item" id="menu-login">
                    <i class="fa-solid fa-right-to-bracket"></i>
                    <span data-i18n="menu_login">Login / Sign Up</span>
                </div>
            </div>
            <div class="menu-footer">
                <div id="drawer-lang-toggle" class="drawer-lang-toggle">
                    <span class="lang-opt" data-lang="kr">한국어</span>
                    <span class="divider">|</span>
                    <span class="lang-opt" data-lang="en">English</span>
                </div>
            </div>
        </div>

        <!-- Modals for Menu Items -->
        <div id="modal-about" class="modal-overlay hidden">
            <div class="modal-content info-modal">
                <h2 data-i18n="menu_about">About</h2>
                <div class="modal-body" id="about-content">
                    <!-- Dynamic Content -->
                </div>
                <button class="close-modal-btn primary-btn">Close</button>
            </div>
        </div>

        <div id="modal-changes" class="modal-overlay hidden">
            <div class="modal-content info-modal wide-modal">
                <h2 data-i18n="menu_changes">Changes</h2>
                <div class="modal-body" id="changelog-content">
                    <!-- Dynamic Content -->
                </div>
                <button class="close-modal-btn primary-btn">Close</button>
            </div>
        </div>

        <!-- Notice Modal -->
        <div id="modal-notices" class="modal-overlay hidden">
            <div class="modal-content info-modal wide-modal">
                <h2 data-i18n="menu_notices">Notices</h2>
                <div class="modal-body" id="notice-content">
                    <!-- Dynamic Content -->
                </div>
                <button class="close-modal-btn primary-btn">Close</button>
            </div>
        </div>

        <!-- Auth Modals -->
        <!-- Login Modal -->
        <div id="modal-auth-login" class="modal-overlay hidden">
            <div class="modal-content auth-modal">
                <h2 data-i18n="auth_login_title">Login</h2>
                <div class="auth-form-group">
                    <label data-i18n="auth_id">ID</label>
                    <input type="text" id="login-id" data-i18n-ph="ph_id" placeholder="Enter ID">
                </div>
                <div class="auth-form-group">
                    <label data-i18n="auth_pw">Password</label>
                    <input type="password" id="login-pw" data-i18n-ph="ph_pw" placeholder="Enter Password">
                </div>
                <button id="btn-login-submit" class="primary-btn full-width" data-i18n="auth_btn_login">Login</button>
                <div class="auth-links">
                    <a href="#" id="link-to-register" data-i18n="auth_link_signup">Sign Up</a>
                    <span class="divider">|</span>
                    <a href="#" id="link-find-id" data-i18n="auth_link_find_id">Forgot ID?</a>
                    <span class="divider">|</span>
                    <a href="#" id="link-find-pw" data-i18n="auth_link_find_pw">Forgot Password?</a>
                </div>
                <button class="close-modal-btn icon-close"><i class="fa-solid fa-xmark"></i></button>
            </div>
        </div>

        <!-- Register Modal -->
        <div id="modal-auth-register" class="modal-overlay hidden">
            <div class="modal-content auth-modal">
                <h2 data-i18n="auth_reg_title">Sign Up</h2>
                <div id="register-step-1">
                    <div class="auth-form-group">
                        <label data-i18n="auth_name">Name</label>
                        <input type="text" id="reg-name" data-i18n-ph="ph_name" placeholder="Enter Name">
                    </div>
                    <div class="auth-form-group">
                        <label data-i18n="auth_email">Email</label>
                        <div class="input-with-btn">
                            <input type="email" id="reg-email" data-i18n-ph="ph_email" placeholder="Enter Email">
                            <button id="btn-reg-verify-email" class="secondary-btn small-btn"
                                data-i18n="auth_btn_verify">Verify</button>
                        </div>
                    </div>
                    <div id="reg-verification-area" class="auth-form-group hidden">
                        <label data-i18n="auth_code">Verification Code</label>
                        <div class="input-with-btn">
                            <input type="text" id="reg-code" data-i18n-ph="ph_code" placeholder="Enter Code">
                            <button id="btn-reg-check-code" class="secondary-btn small-btn"
                                data-i18n="auth_btn_check">Check</button>
                        </div>
                    </div>
                </div>

                <div id="register-step-2" class="hidden">
                    <div class="auth-form-group">
                        <label data-i18n="auth_id">ID</label>
                        <input type="text" id="reg-id" data-i18n-ph="ph_id" placeholder="Enter ID">
                    </div>
                    <div class="auth-form-group">
                        <label data-i18n="auth_pw">Password</label>
                        <input type="password" id="reg-pw" data-i18n-ph="ph_pw" placeholder="Enter Password">
                    </div>
                    <div class="auth-form-group">
                        <label data-i18n="auth_pw_confirm">Confirm Password</label>
                        <input type="password" id="reg-pw-confirm" data-i18n-ph="ph_pw" placeholder="Enter Password">
                    </div>
                    <button id="btn-reg-submit" class="primary-btn full-width" data-i18n="auth_btn_create">Create
                        Account</button>
                </div>
                <button class="close-modal-btn icon-close"><i class="fa-solid fa-xmark"></i></button>
            </div>
        </div>

        <!-- Find ID Modal -->
        <div id="modal-auth-find-id" class="modal-overlay hidden">
            <div class="modal-content auth-modal">
                <h2 data-i18n="auth_find_id_title">Find ID</h2>
                <div class="auth-form-group">
                    <label data-i18n="auth_name">Name</label>
                    <input type="text" id="find-id-name" data-i18n-ph="ph_name" placeholder="Enter Name">
                </div>
                <div class="auth-form-group">
                    <label data-i18n="auth_email">Email</label>
                    <input type="email" id="find-id-email" data-i18n-ph="ph_email" placeholder="Enter Email">
                </div>
                <button id="btn-find-id-submit" class="primary-btn full-width" data-i18n="auth_btn_find_id">Find
                    ID</button>
                <div id="find-id-result" class="result-area hidden">
                    <p>Your ID: <span id="found-id-display" class="highlight-text"></span></p>
                </div>
                <button class="close-modal-btn icon-close"><i class="fa-solid fa-xmark"></i></button>
            </div>
        </div>

        <!-- Find PW Modal -->
        <div id="modal-auth-find-pw" class="modal-overlay hidden">
            <div class="modal-content auth-modal">
                <h2 data-i18n="auth_find_pw_title">Reset Password</h2>
                <div id="reset-step-1">
                    <div class="auth-form-group">
                        <label data-i18n="auth_id">ID</label>
                        <input type="text" id="reset-id" data-i18n-ph="ph_id" placeholder="Enter ID">
                    </div>
                    <div class="auth-form-group">
                        <label data-i18n="auth_email">Email</label>
                        <input type="email" id="reset-email" data-i18n-ph="ph_email" placeholder="Enter Email">
                    </div>
                    <button id="btn-reset-request" class="primary-btn full-width"
                        data-i18n="auth_btn_reset_request">Send Reset Code</button>
                </div>
                <div id="reset-step-2" class="hidden">
                    <div class="auth-form-group">
                        <label data-i18n="auth_code">Verification Code</label>
                        <div class="input-with-btn">
                            <input type="text" id="reset-code" data-i18n-ph="ph_code" placeholder="Enter Code">
                            <button id="btn-reset-check-code" class="secondary-btn small-btn"
                                data-i18n="auth_btn_check">Check</button>
                        </div>
                    </div>
                </div>
                <div id="reset-step-3" class="hidden">
                    <div class="auth-form-group">
                        <label data-i18n="auth_new_pw">New Password</label>
                        <input type="password" id="reset-new-pw" data-i18n-ph="ph_pw" placeholder="Enter New Password">
                    </div>
                    <button id="btn-reset-submit" class="primary-btn full-width" data-i18n="auth_btn_change_pw">Change
                        Password</button>
                </div>
                <button class="close-modal-btn icon-close"><i class="fa-solid fa-xmark"></i></button>
            </div>
        </div>



        <div class="flight-controls" id="flight-controls">
            <!-- Step 1: Destination Selection Info -->
            <div class="control-panel" id="panel-setup">
                <h2 data-i18n="setup_title">나만의 비행 계획</h2>
                <p data-i18n="setup_desc">지구본에서 <strong>출발지</strong>와 <strong>도착지</strong>를 선택하세요.</p>

                <!-- Voice Selection -->
                <div class="voice-selection"
                    style="margin-bottom: 1rem; display: flex; gap: 0.5rem; justify-content: center;">
                    <select id="voice-kr" class="voice-select" style="display: none;">
                        <option value="ko-KR-SunHiNeural">SunHi (여성)</option>
                        <option value="ko-KR-InJoonNeural">InJoon (남성)</option>
                    </select>
                    <select id="voice-en" class="voice-select">
                        <option value="en-US-AriaNeural">Aria (Female)</option>
                        <option value="en-US-GuyNeural">Guy (Male)</option>
                        <option value="en-US-JennyNeural">Jenny (Female)</option>
                        <option value="en-US-ChristopherNeural">Christopher (Male)</option>
                    </select>
                </div>

                <div class="route-info">
                    <div class="airport-box">
                        <span class="label" data-i18n="label_from">출발</span>
                        <span id="origin-code" class="value">--</span>
                    </div>
                    <div class="line"></div>
                    <div class="airport-box">
                        <span class="label" data-i18n="label_to">도착</span>
                        <span id="dest-code" class="value">--</span>
                    </div>
                </div>
                <!-- Real flight info display -->
                <div id="real-flight-info" class="real-flight-info">
                    <h3 data-i18n="label_est_time">예상 비행 시간</h3>
                    <div class="time-big">
                        <i class="fa-regular fa-clock"></i> <span id="real-time-display">--:--:--</span>
                    </div>
                    <!-- Follow Button Moved Here -->
                    <button id="btn-follow-setup" class="map-corner-btn-bl" title="비행기 추적">
                        <i class="fa-solid fa-location-crosshairs"></i>
                    </button>
                    <!-- View Toggle Button Moved Here -->
                    <button id="view-toggle-setup" class="map-corner-btn" title="지도/지구본 전환">
                        <i class="fa-solid fa-map"></i>
                    </button>
                </div>

                <!-- Integrated Flight Controls (Mini Bar) -->
                <div id="integrated-controls" class="integrated-controls hidden">
                    <button id="view-toggle" class="mini-btn hidden" title="지도/지구본 전환">
                        <!-- This original button is hidden/removed in favor of the corner buttons, keeping ID for reference if needed or using new logic -->
                        <i class="fa-solid fa-map"></i>
                    </button>
                    <button id="theme-toggle" class="mini-btn" title="지도 테마 변경" style="display: none;">
                        <i class="fa-solid fa-layer-group"></i>
                    </button>
                    <button id="btn-focus" class="mini-btn" title="비행기 위치로 이동">
                        <i class="fa-solid fa-crosshairs"></i>
                    </button>
                </div>

                <button id="btn-takeoff" class="action-btn" disabled data-i18n="btn_takeoff">
                    비행 시작
                </button>
            </div>

            <!-- Step 2: In Flight Info -->
            <div class="control-panel hidden" id="panel-flight">
                <div class="timer-display" id="flight-timer">00:00:00</div>
                <!-- Interactive Buttons for Flight Mode -->
                <button id="btn-follow-flight" class="map-corner-btn-bl flight-mode-map-btn-bl" title="비행기 추적">
                    <i class="fa-solid fa-location-crosshairs"></i>
                </button>
                <button id="view-toggle-flight" class="map-corner-btn flight-mode-map-btn" title="지도/지구본 전환">
                    <i class="fa-solid fa-map"></i>
                </button>
                <p class="flight-message" id="flight-message" data-i18n="msg_cruising">순항 고도 진입 중</p>
                <button id="btn-abort" class="text-btn" data-i18n="btn_abort">비행 중단</button>
            </div>
        </div>
    </div>

    <!-- Audio Permission & Language Modal -->
    <div id="start-modal" class="modal-overlay">
        <div class="modal-content">
            <i class="fa-solid fa-earth-asia"></i>
            <h2 id="modal-title">Select Language</h2>

            <div id="lang-selection">
                <button class="lang-select-btn" data-lang="kr">한국어</button>
                <button class="lang-select-btn" data-lang="en">English</button>
            </div>

            <div id="enter-app-area" class="hidden">
                <p id="modal-desc">Please enable audio for the best experience.</p>
                <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 1.5rem;">
                    <button id="btn-init-app" class="primary-btn">Enter Cockpit</button>
                </div>
            </div>
        </div>
    </div>

    <div id="toast-container" class="toast-container"></div>
    <script type="module" src="/app.js"></script>
</body>

</html>